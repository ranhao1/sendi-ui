(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{523:function(a,s,t){"use strict";t.r(s);var r=t(57),n=Object(r.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[a._v("#")]),a._v(" 介绍")]),a._v(" "),t("p",[a._v("使用 verdaccio 搭建 npm 私有库，pm2 守护进程。")]),a._v(" "),t("h2",{attrs:{id:"verdaccio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#verdaccio"}},[a._v("#")]),a._v(" verdaccio")]),a._v(" "),t("p",[a._v("后面完善，先参考官方文档 "),t("a",{attrs:{href:"https://verdaccio.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("verdaccio"),t("OutboundLink")],1)]),a._v(" "),t("h2",{attrs:{id:"pm2-守护进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-守护进程"}},[a._v("#")]),a._v(" pm2 守护进程")]),a._v(" "),t("p",[a._v("在确定 verdaccio 安装成功的情况下，使用 pm2 能更好的管理 verdaccio 服务（需要 node.js 环境），避免服务被错误关闭，进程被中断的情况。")]),a._v(" "),t("h3",{attrs:{id:"pm2-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-介绍"}},[a._v("#")]),a._v(" pm2 介绍")]),a._v(" "),t("p",[a._v("pm2 是 node 进程管理工具，可以用它来简化很多 node 应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，而且使用非常简单。关于 pm2 的内容这里不做过多介绍，可以去"),t("a",{attrs:{href:"https://pm2.keymetrics.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网"),t("OutboundLink")],1),a._v("查看了解")]),a._v(" "),t("h3",{attrs:{id:"全局安装-pm2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局安装-pm2"}},[a._v("#")]),a._v(" 全局安装 pm2")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" pm2 -g\n")])])]),t("h3",{attrs:{id:"使用-pm2-启动-verdaccio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-pm2-启动-verdaccio"}},[a._v("#")]),a._v(" 使用 pm2 启动 verdaccio")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("pm2 start verdaccio\n")])])]),t("p",[a._v("如果无法启动，找到 verdaccio 安装目录的 bin 文件夹中的 verdaccio 启动文件（具体路径根据 verdaccio 的安装位置确定）。\n然后执行：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("pm2 start C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Administrator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("AppData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Roaming"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("npm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("node_modules"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("verdaccio"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("verdaccio\n")])])]),t("h3",{attrs:{id:"查看运行状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看运行状态"}},[a._v("#")]),a._v(" 查看运行状态")]),a._v(" "),t("p",[a._v("查看运行状态 "),t("code",[a._v("status: online")]),a._v("，即为正常启动，可以访问使用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("pm2 list\n")])])]),t("h3",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("pm2 logs              "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示所有进程日志")]),a._v("\npm2 stop all          "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 停止所有进程")]),a._v("\npm2 restart all       "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启所有进程")]),a._v("\npm2 stop "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 停止指定的进程")]),a._v("\npm2 restart "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启指定的进程")]),a._v("\npm2 delete "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 杀死指定的进程")]),a._v("\npm2 delete all        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 杀死全部进程")]),a._v("\n\n")])])]),t("h3",{attrs:{id:"pm2-遇到的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-遇到的问题"}},[a._v("#")]),a._v(" pm2 遇到的问题")]),a._v(" "),t("p",[a._v("服务器是 windows 的，在服务器重启后 pm2 不会重启之前的任务，需要手动重启（可能有解决办法，后期研究）。")]),a._v(" "),t("h2",{attrs:{id:"发布-npm-包到私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发布-npm-包到私有仓库"}},[a._v("#")]),a._v(" 发布 npm 包到私有仓库")]),a._v(" "),t("p",[a._v("!> 下面的命名需要先把 npm 源设置为私有包地址，或者使用 --registry 参数")]),a._v(" "),t("h3",{attrs:{id:"创建本地-npm-用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建本地-npm-用户"}},[a._v("#")]),a._v(" 创建本地 npm 用户")]),a._v(" "),t("p",[a._v("需要创建本地 npm 用户，用于上传和管理 npm 包，使用 npm adduser 创建用户，输入用户名、密码、邮箱。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" adduser\nUsername: yourname\nPassword: *\nEmail: *\n")])])]),t("h3",{attrs:{id:"登录并发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录并发布"}},[a._v("#")]),a._v(" 登录并发布")]),a._v(" "),t("p",[a._v("如果已经注册可以直接登录")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 登录npm")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 根据提示输入账户/密码/邮箱")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" login\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 登录成功，发布")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" publish\n\n")])])]),t("h2",{attrs:{id:"npm-更新发布后的包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#npm-更新发布后的包"}},[a._v("#")]),a._v(" npm 更新发布后的包")]),a._v(" "),t("blockquote",[t("p",[a._v("版本号只能新增，禁止下降，代码修改必须以新版本的形式更新")])]),a._v(" "),t("p",[a._v("npm 更新和发布的命令是相同的，都是用 "),t("code",[a._v("npm publish")]),a._v(" 命令。不同之处在于，需要修改包的版本，步骤如下：")]),a._v(" "),t("ul",[t("li",[a._v("修改包的版本（package.json 中的 version 字段）")]),a._v(" "),t("li",[a._v("执行 "),t("code",[a._v("npm publish")])])]),a._v(" "),t("h3",{attrs:{id:"npm-版本控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#npm-版本控制"}},[a._v("#")]),a._v(" npm 版本控制")]),a._v(" "),t("p",[a._v("版本号格式：主版本号.次版本号.修订版本号")]),a._v(" "),t("p",[a._v("版本号递增规则：")]),a._v(" "),t("ul",[t("li",[a._v("主版本号：做了不兼容修改或颠覆式重写")]),a._v(" "),t("li",[a._v("次版本号：向下兼容的功能性更新")]),a._v(" "),t("li",[a._v("修订版本号：向下兼容的问题修复")])]),a._v(" "),t("p",[a._v("可以通过 "),t("code",[a._v("npm version <update_type>")]),a._v(" 命令自动改变版本，updata_type 的可选值如下：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("major   # 增加主版本号\nminor   # 增加次版本号\npath    # 增加修订版本号\n")])])]),t("h2",{attrs:{id:"使用-nrm-管理-npm-源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-nrm-管理-npm-源"}},[a._v("#")]),a._v(" 使用 nrm 管理 npm 源")]),a._v(" "),t("p",[a._v("一般在本地会有多个 npm 源，可以使用 "),t("a",{attrs:{href:"https://github.com/Pana/nrm",target:"_blank",rel:"noopener noreferrer"}},[a._v("nrm"),t("OutboundLink")],1),a._v(" 对其进行管理与切换。")]),a._v(" "),t("h3",{attrs:{id:"安装-nrm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-nrm"}},[a._v("#")]),a._v(" 安装 nrm")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" nrm -g\n")])])]),t("h3",{attrs:{id:"增加本地-npm-源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加本地-npm-源"}},[a._v("#")]),a._v(" 增加本地 npm 源")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("nrm add localnpm *.*.*.*:4873\n")])])]),t("h3",{attrs:{id:"查看是否添加成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看是否添加成功"}},[a._v("#")]),a._v(" 查看是否添加成功")]),a._v(" "),t("p",[a._v("nrm ls")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 源列表")]),a._v("\n* "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" -----  https://registry.npmjs.org/\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" ----- https://registry.yarnpkg.com\n  cnpm ----  http://r.cnpmjs.org/\n  taobao --  https://registry.npm.taobao.org/\n  nj ------  https://registry.nodejitsu.com/\n  skimdb -- https://skimdb.npmjs.com/registry\n  localnpm --- http://*.*.*.*:4873/\n")])])]),t("h3",{attrs:{id:"切换源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#切换源"}},[a._v("#")]),a._v(" 切换源")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("nrm use cnpm  //switch registry to cnpm\n\n    Registry has been "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" to: http://r.cnpmjs.org/\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);